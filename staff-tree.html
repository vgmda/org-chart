<!DOCTYPE html>  
<html>  
  <head>  
    <meta charset="UTF-8" />  
    <title>OrgChart – Staff (Full)</title>  
    <link rel="shortcut icon" type="image/x-icon" href="misc/favicon.ico" />  
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />  
  </head>  
  
  <body>  
    <!-- NON ESSENTIAL CONTENT (buttons / PDF etc.) -->  
    <script src="https://unpkg.com/html2canvas@1.1.4/dist/html2canvas.js"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>  
    <link  
      href="https://cdn.jsdelivr.net/npm/simptip@1.0.4/simptip.min.css"  
      rel="stylesheet"  
    />  
  
    <style>  
      [data-tooltip]:focus:after {  
        display: none;  
        border-bottom-color: none !important;  
      }  
      [data-tooltip]:focus:before {  
        display: none;  
        border-bottom-color: none !important;  
      }  
      [data-tooltip]:after {  
        height: auto !important;  
        padding: 11px 11px 11px 11px !important;  
        content: attr(data-tooltip);  
        white-space: pre;  
        line-height: 16px !important;  
        text-align: left !important;  
      }  
    </style>  
  
    <div class="action-buttons" style="margin: 0 100px">  
      <button  
        onclick='chart.setExpanded("jonathan.fanti").render()'  
        class="simptip-position-bottom"  
        data-tooltip='chart.setExpanded("jonathan.fanti") &#xa; .render()'  
      >  
        Expand Jonathan Fanti  
      </button>  
      <button  
        onclick="chart.fit()"  
        class="simptip-position-bottom"  
        data-tooltip="chart.fit()"  
      >  
        Fit  
      </button>  
      <button  
        onclick='chart.layout(["right","bottom","left","top"][index++%4]).render().fit()'  
        class="simptip-position-bottom"  
        data-tooltip='chart.layout(["right","bottom","left","top"][index++%4]) &#xa; .render() &#xa; .fit()'  
      >  
        Swap Layouts  
      </button>  
      <button  
        onclick="chart.expandAll()"  
        class="simptip-position-bottom"  
        data-tooltip="chart.expandAll()"  
      >  
        Expand All  
      </button>  
      <button  
        onclick="chart.collapseAll()"  
        class="simptip-position-bottom"  
        data-tooltip="chart.collapseAll()"  
      >  
        Collapse All  
      </button>  
      <button  
        onclick="chart.fullscreen()"  
        class="simptip-position-bottom"  
        data-tooltip="chart.fullscreen()"  
      >  
        Full Screen  
      </button>  
      <button  
        onclick="chart.zoomIn()"  
        class="simptip-position-bottom"  
        data-tooltip="chart.zoomIn()"  
      >  
        Zoom In  
      </button>  
      <button  
        onclick="chart.zoomOut()"  
        class="simptip-position-bottom"  
        data-tooltip="chart.zoomOut()"  
      >  
        Zoom Out  
      </button>  
      <button  
        onclick="chart.exportImg({full:true})"  
        class="simptip-position-bottom"  
        data-tooltip="chart.exportImg({full:true})"  
      >  
        Export Full Image  
      </button>  
      <button  
        onclick="chart.exportSvg()"  
        class="simptip-position-bottom"  
        data-tooltip="chart.exportSvg()"  
      >  
        Export SVG  
      </button>  
      <button  
        onclick="downloadPdf()"  
        class="simptip-position-bottom"  
        data-tooltip="downloadPdf()"  
      >  
        Download PDF  
      </button>  
  
      <script>  
        function downloadPdf() {  
          chart.exportImg({  
            save: false,  
            onLoad: (base64) => {  
              var pdf = new jspdf.jsPDF();  
              var img = new Image();  
              img.src = base64;  
              img.onload = function () {  
                pdf.addImage(  
                  img,  
                  "JPEG",  
                  5,  
                  5,  
                  595 / 3,  
                  ((img.height / img.width) * 595) / 3  
                );  
                pdf.save("chart.pdf");  
              };  
            },  
          });  
        }  
      </script>  
    </div>  
  
    <a href="https://github.com/bumbeishvili/d3-organization-chart">  
      <img  
        style="position: fixed; top: 0; right: 0; border: 0; z-index: 2"  
        width="149"  
        height="149"  
        src="https://bumbeishvili.github.io/d3-tooltip/forkme.png"  
        alt="Fork me on GitHub"  
      />  
    </a>  
  
    <!-- ORG CHART ESSENTIAL CONTENT -->  
    <script src="https://d3js.org/d3.v7.min.js"></script>  
    <script src="./build/d3-org-chart.js"></script>  
    <script src="https://cdn.jsdelivr.net/npm/d3-flextree@2.0.0/build/d3-flextree.js"></script>  
  
    <div  
      class="chart-container"  
      style="padding-top: 10px; height: 1200px; background-color: white"  
    ></div>  
  
    <script>  
      var index = 0;  
      var chart;  
  
      // IMPORTANT: adjust this filename if you used a different one  
      d3.csv("misc/staff_full.csv").then((rows) => {  
        // Drop empty lines  
        rows = rows.filter((r) => r.id);  
  
        // Map manager -> parentId and normalise some fields  
        rows.forEach((d) => {  
          d.parentId = d.manager || "";  
          d.name = d.name || d["name"];  
          d.title = d.title || d["title"];  
        });  
  
        // Optional: debug to see what the data looks like  
        console.log("ROW SAMPLE", rows[0], rows[1], rows[2]);  
  
        chart = new d3.OrgChart()  
          .container(".chart-container")  
          .pagingStep((d) => 20) // more per page because you have many nodes  
          .minPagingVisibleNodes((d) => 5)  
          .data(rows)  
          .nodeHeight((d) => 110)  
          .nodeWidth((d) => 260)  
          .childrenMargin((d) => 40)  
          .onNodeClick((d) => console.log(d))  
          .compactMarginBetween((d) => 35)  
          .compactMarginPair((d) => 30)  
          .neighbourMargin((a, b) => 20)  
          .nodeContent(function (d) {  
            const data = d.data;  
            return `  
              <div style="  
                  box-sizing:border-box;  
                  padding:8px;  
                  width:${d.width}px;  
                  height:${d.height}px;  
                  border-radius:8px;  
                  background:#ffffff;  
                  border:1px solid #E4E2E9;  
                  font-family:'Inter', sans-serif;  
                  font-size:12px;  
                ">  
                <div style="font-weight:600;font-size:14px;margin-bottom:4px;">  
                  ${data.name || ""}  
                </div>  
                <div style="color:#555;margin-bottom:4px;">  
                  ${data.title || ""}  
                </div>  
                <div style="color:#777;font-size:11px;margin-bottom:2px;">  
                  ${data.region || ""} ${  
              data.country ? "• " + data.country : ""  
            }  
                </div>  
                <div style="color:#999;font-size:10px;">  
                  Manager: ${data.manager || "—"}  
                </div>  
              </div>  
            `;  
          });  
  
        // Keep the layout tweaks from the original demo  
        chart.layoutBindings(  
          (() => {  
            const layouts = chart.layoutBindings();  
            layouts.top.linkY = (node) => node.y + 0;  
            layouts.top.linkCompactYStart = (node) =>  
              node.y + node.height / 2 + 15;  
            return layouts;  
          })()  
        );  
  
        chart.render();  
      });  
    </script>  
  
    <link rel="preconnect" href="https://fonts.googleapis.com" />  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />  
    <link  
      href="https://fonts.googleapis.com/css2?family=Inter&display=swap"  
      rel="stylesheet"  
    />  
    <link  
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"  
      rel="stylesheet"  
    />  
    <style></style>  
  </body>  
</html>  
